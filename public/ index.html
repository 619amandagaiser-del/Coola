<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titan Hub: Monkey Edition</title>
    <style>
        :root { --bg: #0d1117; --nav: #161b22; --accent: #58a6ff; --text: #c9d1d9; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; }
        
        /* Nav & Proxy Bar */
        nav { background: var(--nav); padding: 10px 20px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #30363d; }
        .logo { font-weight: bold; color: var(--accent); cursor: pointer; font-size: 1.3rem; }
        .search-container { flex: 1; display: flex; max-width: 600px; background: #010409; border: 1px solid #30363d; border-radius: 8px; overflow: hidden; }
        input { flex: 1; background: transparent; border: none; padding: 10px; color: white; outline: none; }
        button { background: #21262d; border: none; color: var(--accent); padding: 0 20px; cursor: pointer; font-weight: 600; }
        button:hover { background: #30363d; }

        /* Game Grid */
        #container { flex: 1; overflow-y: auto; padding: 25px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .game-card { background: var(--nav); border: 1px solid #30363d; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; position: relative; }
        .game-card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .game-card b { display: block; margin-top: 10px; font-size: 0.9rem; }
        .game-card i { font-size: 2.5rem; font-style: normal; }

        /* Fullscreen View */
        #view-wrapper { display: none; flex: 1; width: 100%; height: 100%; position: relative; }
        iframe { width: 100%; height: 100%; border: none; background: white; }
        .back-btn { position: absolute; top: 10px; left: 10px; padding: 5px 15px; background: rgba(0,0,0,0.7); color: white; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<nav>
    <div class="logo" onclick="showHome()">TITAN</div>
    <div class="search-container">
        <input type="text" id="urlInput" placeholder="Enter URL or Game Name...">
        <button onclick="launchProxy()">Browse</button>
    </div>
</nav>

<div id="container">
    <div id="game-grid" class="grid">
        <p id="loading">Loading MonkeyGG2 Games...</p>
    </div>
</div>

<div id="view-wrapper">
    <div class="back-btn" onclick="showHome()">‚Üê Back</div>
    <iframe id="viewport"></iframe>
</div>

<script>
    // 1. Target the MonkeyGG2 Repository
    const GITHUB_REPO = "https://raw.githubusercontent.com/MonkeyGG2/monkeygg2.github.io/main";
    
    async function fetchMonkeyGames() {
        try {
            // We fetch the config file from the repo which contains the game list
            const response = await fetch(`${GITHUB_REPO}/config.jsonc`);
            const text = await response.text();
            
            // Clean up JSONC (JSON with comments)
            const cleanJson = text.replace(/\/\/.*|\/\*[\s\S]*?\*\//g, "");
            const data = JSON.parse(cleanJson);
            
            displayGames(data.games);
        } catch (e) {
            document.getElementById('loading').innerText = "Error loading games. Make sure the repo URL is correct.";
            console.error(e);
        }
    }

    function displayGames(games) {
        const grid = document.getElementById('game-grid');
        grid.innerHTML = ""; // Clear loading message

        Object.keys(games).forEach(key => {
            const game = games[key];
            const card = document.createElement('div');
            card.className = 'game-card';
            
            // Generate a random fun emoji if no icon exists
            const emojis = ["üéÆ", "üïπÔ∏è", "üéØ", "üé≤", "üëæ", "‚ö°"];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            card.innerHTML = `<i>${randomEmoji}</i><b>${key}</b>`;
            
            // Set the click action to load the game path from the repo
            card.onclick = () => {
                const gameUrl = `${GITHUB_REPO}/games/${game.path}`;
                openContent(gameUrl);
            };
            
            grid.appendChild(card);
        });
    }

    function openContent(url) {
        document.getElementById('container').style.display = 'none';
        document.getElementById('view-wrapper').style.display = 'flex';
        document.getElementById('viewport').src = url;
    }

    function showHome() {
        document.getElementById('view-wrapper').style.display = 'none';
        document.getElementById('viewport').src = "";
        document.getElementById('container').style.display = 'block';
    }

    function launchProxy() {
        const input = document.getElementById('urlInput').value;
        if (!input) return;
        // Logic to route through your Firebase /p rewrite
        const finalUrl = input.startsWith('http') ? `/p?url=${encodeURIComponent(input)}` : `/p?url=https://${input}`;
        openContent(finalUrl);
    }

    // Start fetching on load
    fetchMonkeyGames();
</script>

</body>
</html>
